<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>nullarmor | Lame - Hack The Box</title>
  <meta name="description" content="Resolution of the Lame machine">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Lame - Hack The Box">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://nullarmor.github.io/posts/lame">
  <meta property="og:description" content="Resolution of the Lame machine">
  <meta property="og:site_name" content="nullarmor">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://nullarmor.github.io/posts/lame">
  <meta name="twitter:title" content="Lame - Hack The Box">
  <meta name="twitter:description" content="Resolution of the Lame machine">
  <meta name="google-site-verification" content="1sfOj2zDu7c444806MBQqbqFzNWxik880zgryQLMj-o" />

  
    
      <meta property="og:image" content="https://nullarmor.github.io/assets/hackthebox/lame/lame-00-9347ce4ef80880707552c81c8342858ba00ab616da15058bce86e08b9156080a.png">
      <meta name="twitter:image" content="https://nullarmor.github.io/assets/hackthebox/lame/lame-00-9347ce4ef80880707552c81c8342858ba00ab616da15058bce86e08b9156080a.png">
    
  

  <link href="https://nullarmor.github.io/feed.xml" type="application/rss+xml" rel="alternate" title="nullarmor Last 10 blog posts" />

  

  

    
      <link rel="icon" type="image/x-icon" href="/assets/favicon-5df081ea197cddd592e345971da85e359e2f613dae2506c368835a695a297f82.gif">
      <link rel="apple-touch-icon" href="/assets/favicon-5df081ea197cddd592e345971da85e359e2f613dae2506c368835a695a297f82.gif">
      <link rel="stylesheet" type="text/css" title="light" id="light" href="/assets/light-fd3e34295723b96a04f635903b3650e5bb101ebdcc4d959165c3b4d2d88abe5e.css">
      <link rel="stylesheet" type="text/css" title="dark" id="dark" href="/assets/dark-0f2545b8bdef934d32dd563b17074c614e7f4f4d5c3e682d4089a07fed36aa84.css" disabled="false">
    

  

</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="nullarmor">nullarmor</a>
  <ul class="header-links">
    
      <li>
        <a href="/about" title="About me">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-about">
  <use href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about" xlink:href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="https://twitter.com/nullarmor" rel="noreferrer noopener" target="_blank" title="Twitter">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-twitter">
  <use href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter" xlink:href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter"></use>
</svg>

        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://github.com/nullarmor" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github" xlink:href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/renan-almeida-8137a81a6" rel="noreferrer noopener" target="_blank" title="LinkedIn">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-linkedin">
  <use href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin" xlink:href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="mailto:nullarmor@protonmail.com" title="Email">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-email">
  <use href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email" xlink:href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email"></use>
</svg>

        </a>
      </li>
    
    
    
      <li>
        <a onclick="toggle()" title="Toggle Theme">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-theme">
  <use href="/assets/theme-66869e0bf8dab34bae1c86bda400327b772e0be69e8dc28d3ede896e771320ed.svg#icon-theme" xlink:href="/assets/theme-66869e0bf8dab34bae1c86bda400327b772e0be69e8dc28d3ede896e771320ed.svg#icon-theme"></use>
</svg>

        </a>
      </li>
    
  </ul>
</nav>


  <ul class="header-tags scrollappear">
    
    
      
        <li><a href="/tag/ctf">Ctf</a></li>
    
      
        <li><a href="/tag/cybrics">Cybrics</a></li>
    
      
        <li><a href="/tag/hackthebox">Hackthebox</a></li>
    
      
        <li><a href="/tag/hacktivitycon">Hacktivitycon</a></li>
    
      
        <li><a href="/tag/pwn">Pwn</a></li>
    
      
        <li><a href="/tag/rev">Rev</a></li>
    
      
        <li><a href="/tag/rgbctf">Rgbctf</a></li>
    
      
        <li><a href="/tag/web">Web</a></li>
    
  </ul>


        <article class="article scrollappear">
          <header class="article-header">
            <h1>Lame - Hack The Box</h1>
            <p>Resolution of the Lame machine</p>
            <div class="article-list-footer">
  <span class="article-list-date">
    May 18, 2020
  </span>
  <span class="article-list-divider">-</span>
  <span class="article-list-minutes">
    
    
      3 minute read
    
  </span>
  <span class="article-list-divider">-</span>
  <div class="article-list-tags">
    
      
      <a href="/tag/hackthebox" title="See all posts with tag 'HackTheBox'">HackTheBox</a>
    
  </div>
</div>
          </header>

          <div class="article-content">
            <p><a href="/assets/hackthebox/lame/lame-00-9347ce4ef80880707552c81c8342858ba00ab616da15058bce86e08b9156080a.png">
  <img src="/assets/hackthebox/lame/lame-00-9347ce4ef80880707552c81c8342858ba00ab616da15058bce86e08b9156080a.png" alt="Lame banner" class="zooming" data-rjs="/assets/hackthebox/lame/lame-00-9347ce4ef80880707552c81c8342858ba00ab616da15058bce86e08b9156080a.png" data-zooming-width="597" data-zooming-height="379">
</a></p>

<p>Lame is an easy level machine based on Linux, has two initial exploit methods and both of them are pretty easy. The privilege escalation is easy and exploits an old Nmap module.</p>

<h1 id="recon">Recon</h1>

<p>Starting with Nmap:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># Nmap 7.70 scan initiated Mon Dec 30 20:49:00 2019 as: nmap -sV -sC -oA lame -T4 -p- 10.10.10.3</span>
Nmap scan report <span class="k">for </span>10.10.10.3
Host is up <span class="o">(</span>0.12s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 65530 filtered ports
PORT     STATE SERVICE     VERSION
21/tcp   open  ftp         vsftpd 2.3.4
|_ftp-anon: Anonymous FTP login allowed <span class="o">(</span>FTP code 230<span class="o">)</span>
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to 10.10.14.7
|      Logged <span class="k">in </span>as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session <span class="nb">timeout </span><span class="k">in </span>seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      vsFTPd 2.3.4 - secure, fast, stable
|_End of status
22/tcp   open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 <span class="o">(</span>protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   1024 60:0f:cf:e1:c0:5f:6a:74:d6:90:24:fa:c4:d5:6c:cd <span class="o">(</span>DSA<span class="o">)</span>
|_  2048 56:56:24:0f:21:1d:de:a7:2b:ae:61:b1:24:3d:e8:f3 <span class="o">(</span>RSA<span class="o">)</span>
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X <span class="o">(</span>workgroup: WORKGROUP<span class="o">)</span>
445/tcp  open  netbios-ssn Samba smbd 3.0.20-Debian <span class="o">(</span>workgroup: WORKGROUP<span class="o">)</span>
3632/tcp open  distccd     distccd v1 <span class="o">((</span>GNU<span class="o">)</span> 4.2.4 <span class="o">(</span>Ubuntu 4.2.4-1ubuntu4<span class="o">))</span>
Service Info: OSs: Unix, Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: <span class="nt">-2d21h56m04s</span>, deviation: 0s, median: <span class="nt">-2d21h56m04s</span>
| smb-os-discovery: 
|   OS: Unix <span class="o">(</span>Samba 3.0.20-Debian<span class="o">)</span>
|   NetBIOS computer name: 
|   Workgroup: WORKGROUP<span class="se">\x</span>00
|_  System <span class="nb">time</span>: 2019-12-27T14:55:36-05:00
|_smb2-time: Protocol negotiation failed <span class="o">(</span>SMB2<span class="o">)</span>

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Mon Dec 30 20:52:21 2019 -- 1 IP address (1 host up) scanned in 200.72 seconds</span></code></pre></figure>

<p>Looking for exploits and we found an interesting vulnerability that exploits the program named <code class="highlighter-rouge">vsftpd 2.3.4</code> but unfortunately the Lame machine appears to be patched against it, a rabbit hole.</p>

<p>On port 139 we have a service named <code class="highlighter-rouge">Samba</code>, this service has a vulnerability named <code class="highlighter-rouge">CVE 2007-2447</code>, the vulnerability allow us to inject system commands through SMB username.
Metasploit has a module named <code class="highlighter-rouge">multi/samba/usermap_script</code>.</p>

<p>On port 3632 we have a service named <code class="highlighter-rouge">distccd v1</code>, this service has an old vulnerability that was discovered in 2002 (lol)
Metasploit has a module named <code class="highlighter-rouge">unix/misc/distcc_exec</code>.</p>

<h1 id="exploiting---using-the-samba-exploit-1st-method">Exploiting - Using the Samba exploit (1st method)</h1>

<p>This method gives us root access, after that we own the entire machine without escalating any privileges.</p>

<p><a href="/assets/hackthebox/lame/lame-01-c3df5eed492272c86c4c01345592f97125fb0e9d268b32df11f3754762090d66.png">
  <img src="/assets/hackthebox/lame/lame-01-c3df5eed492272c86c4c01345592f97125fb0e9d268b32df11f3754762090d66.png" alt="Lame Exploiting" class="zooming" data-rjs="/assets/hackthebox/lame/lame-01-c3df5eed492272c86c4c01345592f97125fb0e9d268b32df11f3754762090d66.png" data-zooming-width="862" data-zooming-height="466">
</a></p>

<h1 id="exploiting---using-the-distcc-exploit-2nd-method">Exploiting - Using the DistCC exploit (2nd method)</h1>

<p>This method gives us normal user access, after that we need to escalate privileges.</p>

<p><a href="/assets/hackthebox/lame/lame-02-d8e0cc41dee56a71a2cfa89a664769e97d8da396d4ba427a89d007f3b0627d03.png">
  <img src="/assets/hackthebox/lame/lame-02-d8e0cc41dee56a71a2cfa89a664769e97d8da396d4ba427a89d007f3b0627d03.png" alt="Lame Exploiting" class="zooming" data-rjs="/assets/hackthebox/lame/lame-02-d8e0cc41dee56a71a2cfa89a664769e97d8da396d4ba427a89d007f3b0627d03.png" data-zooming-width="854" data-zooming-height="521">
</a></p>

<h1 id="exploiting---using-a-custom-exploit">Exploiting - Using a custom exploit</h1>

<p>For knowledge purposes I made a custom exploit that exploits the DistCC vulnerability and spawn an interactive reverse shell to us, it’s available on my GitHub :)</p>

<p><a href="https://github.com/nullarmor/hackthebox-exploits/tree/master/lame" target="_blank">Lame Exploit</a></p>

<p><a href="/assets/hackthebox/lame/lame-03-22bea31c1cb163edaaf8cc4a53c04b7c6594c630374d5b8bcfca3d14f76945c4.png">
  <img src="/assets/hackthebox/lame/lame-03-22bea31c1cb163edaaf8cc4a53c04b7c6594c630374d5b8bcfca3d14f76945c4.png" alt="Lame Exploit" class="zooming" data-rjs="/assets/hackthebox/lame/lame-03-22bea31c1cb163edaaf8cc4a53c04b7c6594c630374d5b8bcfca3d14f76945c4.png" data-zooming-width="643" data-zooming-height="226">
</a></p>

<h1 id="post-exploitation---exploiting-an-old-and-deprecated-module-from-nmap">Post Exploitation - Exploiting an old and deprecated module from Nmap</h1>

<p>Enumerating the machine using a tool named <a href="https://github.com/rebootuser/LinEnum/blob/master/LinEnum.sh" target="_blank">LinEnum</a> we found a possible privilege escalation point:</p>

<p><a href="/assets/hackthebox/lame/lame-04-2b9887e4fdb858a5ce6c82c26dc9d981b64fa71f8788b1728c43dc1b9687903d.png">
  <img src="/assets/hackthebox/lame/lame-04-2b9887e4fdb858a5ce6c82c26dc9d981b64fa71f8788b1728c43dc1b9687903d.png" alt="Lame Post Exploitation" class="zooming" data-rjs="/assets/hackthebox/lame/lame-04-2b9887e4fdb858a5ce6c82c26dc9d981b64fa71f8788b1728c43dc1b9687903d.png" data-zooming-width="573" data-zooming-height="57">
</a></p>

<p>After some Googling we found that old versions of Nmap had a module named <code class="highlighter-rouge">interactive mode</code> that allowed the user to execute system commands inside the Nmap. This module was implemented between the versions <code class="highlighter-rouge">2.02</code> until <code class="highlighter-rouge">5.21</code> and now is considered deprecated and insecure.</p>

<p>Now we just call <code class="highlighter-rouge">nmap --interactive</code>, type <code class="highlighter-rouge">!sh</code> and a root shell is spawned!</p>

<p><a href="/assets/hackthebox/lame/lame-05-5317ab97407f447178adaacc7836e29b8abfc6267b4fc0aa11b09331e3bbfa36.png">
  <img src="/assets/hackthebox/lame/lame-05-5317ab97407f447178adaacc7836e29b8abfc6267b4fc0aa11b09331e3bbfa36.png" alt="Lame Post Exploitation" class="zooming" data-rjs="/assets/hackthebox/lame/lame-05-5317ab97407f447178adaacc7836e29b8abfc6267b4fc0aa11b09331e3bbfa36.png" data-zooming-width="423" data-zooming-height="227">
</a></p>


          </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=Lame+-+Hack+The+Box%20-%20https://nullarmor.github.io/posts/lame%20by%20@nullarmor" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewbox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"></path></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https://nullarmor.github.io/posts/lame" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewbox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"></path></svg>
            </a>
          </div>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script src="https://nullarmor.disqus.com/embed.js" async defer></script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
          
        </article>
        <footer class="footer scrollappear">
  <p>
    This site uses Chalk theme made by Nielsen Ramon.
  </p>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-159304176-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-159304176-1');
  </script>


<script type="text/javascript" src="/assets/vendor-2c224c53eb697c739f9490c38819a72184f09472739fd9e492272ef174090428.js"></script>


  <script type="text/javascript" src="/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js"></script>



  <script type="text/javascript" src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js"></script>


<script type="text/javascript" src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js"></script>


  <script type="text/javascript" src="/assets/themetoggle-df0d3d73164dc26dffbd630182ae4d0dfa7bee6b694a2b5d565d73595b582bbf.js"></script>

</body>
</html>
