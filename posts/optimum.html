<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>nullarmor | Optimum - Hack The Box</title>
  <meta name="description" content="Resolution of the Optimum machine">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Optimum - Hack The Box">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://nullarmor.github.io/posts/optimum">
  <meta property="og:description" content="Resolution of the Optimum machine">
  <meta property="og:site_name" content="nullarmor">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://nullarmor.github.io/posts/optimum">
  <meta name="twitter:title" content="Optimum - Hack The Box">
  <meta name="twitter:description" content="Resolution of the Optimum machine">
  <meta name="google-site-verification" content="1sfOj2zDu7c444806MBQqbqFzNWxik880zgryQLMj-o" />

  
    
      <meta property="og:image" content="https://nullarmor.github.io/assets/hackthebox/optimum/optimum-00-e43ddfa7c4647183a516e0bab87cdc84118e7271acd500bee3c5c9d609c119d1.png">
      <meta name="twitter:image" content="https://nullarmor.github.io/assets/hackthebox/optimum/optimum-00-e43ddfa7c4647183a516e0bab87cdc84118e7271acd500bee3c5c9d609c119d1.png">
    
  

  <link href="https://nullarmor.github.io/feed.xml" type="application/rss+xml" rel="alternate" title="nullarmor Last 10 blog posts" />

  

  

    
      <link rel="icon" type="image/x-icon" href="/assets/favicon-5df081ea197cddd592e345971da85e359e2f613dae2506c368835a695a297f82.gif">
      <link rel="apple-touch-icon" href="/assets/favicon-5df081ea197cddd592e345971da85e359e2f613dae2506c368835a695a297f82.gif">
      <link rel="stylesheet" type="text/css" title="light" id="light" href="/assets/light-fd3e34295723b96a04f635903b3650e5bb101ebdcc4d959165c3b4d2d88abe5e.css">
      <link rel="stylesheet" type="text/css" title="dark" id="dark" href="/assets/dark-0f2545b8bdef934d32dd563b17074c614e7f4f4d5c3e682d4089a07fed36aa84.css" disabled="false">
    

  

</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="nullarmor">nullarmor</a>
  <ul class="header-links">
    
      <li>
        <a href="/about" title="About me">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-about">
  <use href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about" xlink:href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="https://twitter.com/nullarmor" rel="noreferrer noopener" target="_blank" title="Twitter">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-twitter">
  <use href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter" xlink:href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter"></use>
</svg>

        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://github.com/nullarmor" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github" xlink:href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/renan-almeida-8137a81a6" rel="noreferrer noopener" target="_blank" title="LinkedIn">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-linkedin">
  <use href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin" xlink:href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="mailto:nullarmor@protonmail.com" title="Email">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-email">
  <use href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email" xlink:href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email"></use>
</svg>

        </a>
      </li>
    
    
    
      <li>
        <a onclick="toggle()" title="Toggle Theme">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-theme">
  <use href="/assets/theme-66869e0bf8dab34bae1c86bda400327b772e0be69e8dc28d3ede896e771320ed.svg#icon-theme" xlink:href="/assets/theme-66869e0bf8dab34bae1c86bda400327b772e0be69e8dc28d3ede896e771320ed.svg#icon-theme"></use>
</svg>

        </a>
      </li>
    
  </ul>
</nav>


  <ul class="header-tags scrollappear">
    
    
      
        <li><a href="/tag/ctf">Ctf</a></li>
    
      
        <li><a href="/tag/cybrics">Cybrics</a></li>
    
      
        <li><a href="/tag/hackthebox">Hackthebox</a></li>
    
      
        <li><a href="/tag/hacktivitycon">Hacktivitycon</a></li>
    
      
        <li><a href="/tag/pwn">Pwn</a></li>
    
      
        <li><a href="/tag/rev">Rev</a></li>
    
      
        <li><a href="/tag/rgbctf">Rgbctf</a></li>
    
      
        <li><a href="/tag/web">Web</a></li>
    
  </ul>


        <article class="article scrollappear">
          <header class="article-header">
            <h1>Optimum - Hack The Box</h1>
            <p>Resolution of the Optimum machine</p>
            <div class="article-list-footer">
  <span class="article-list-date">
    June 25, 2020
  </span>
  <span class="article-list-divider">-</span>
  <span class="article-list-minutes">
    
    
      3 minute read
    
  </span>
  <span class="article-list-divider">-</span>
  <div class="article-list-tags">
    
      
      <a href="/tag/hackthebox" title="See all posts with tag 'HackTheBox'">HackTheBox</a>
    
  </div>
</div>
          </header>

          <div class="article-content">
            <p><a href="/assets/hackthebox/optimum/optimum-00-e43ddfa7c4647183a516e0bab87cdc84118e7271acd500bee3c5c9d609c119d1.png">
  <img src="/assets/hackthebox/optimum/optimum-00-e43ddfa7c4647183a516e0bab87cdc84118e7271acd500bee3c5c9d609c119d1.png" alt="Optimum banner" class="zooming" data-rjs="/assets/hackthebox/optimum/optimum-00-e43ddfa7c4647183a516e0bab87cdc84118e7271acd500bee3c5c9d609c119d1.png" data-zooming-width="597" data-zooming-height="381" />
</a></p>

<p>Optimum is an easy level machine based on Windows, the initial and privilege escalate process are based on CVE’s.
The initial approach relies on a RCE vulnerability present on a web application named <code class="highlighter-rouge">HttpFileServer</code>.
The privilege escalation process exploits a buffer overflow in the Windows component named <code class="highlighter-rouge">RGNOBJ</code>.</p>

<h1 id="recon">Recon</h1>

<p>Starting with Nmap:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># Nmap 7.70 scan initiated Fri Mar 13 15:35:31 2020 as: nmap -sC -sV -Pn -T4 -oA optimum 10.10.10.8</span>
Nmap scan report <span class="k">for </span>10.10.10.8
Host is up <span class="o">(</span>0.14s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 999 filtered ports
PORT   STATE SERVICE VERSION
80/tcp open  http    HttpFileServer httpd 2.3
|_http-server-header: HFS 2.3
|_http-title: HFS /
Service Info: OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Fri Mar 13 15:35:54 2020 -- 1 IP address (1 host up) scanned in 22.77 seconds</span></code></pre></figure>

<p>On port 80 the server has a web application named <code class="highlighter-rouge">HttpFileServer 2.3</code>:</p>

<p><a href="/assets/hackthebox/optimum/optimum-01-defd787848ff49cb3e72b30be6d812ccf28d9f5323d9fb42ac8413526d2bb063.png">
  <img src="/assets/hackthebox/optimum/optimum-01-defd787848ff49cb3e72b30be6d812ccf28d9f5323d9fb42ac8413526d2bb063.png" alt="Optimum Recon" class="zooming" data-rjs="/assets/hackthebox/optimum/optimum-01-defd787848ff49cb3e72b30be6d812ccf28d9f5323d9fb42ac8413526d2bb063.png" data-zooming-width="929" data-zooming-height="553" />
</a></p>

<h1 id="exploiting---using-a-python-script">Exploiting - Using a Python script</h1>

<p>Searching for suitable exploits for HttpFileServer version 2.3 on Google we found an interesting exploit:</p>

<p><a href="https://www.exploit-db.com/exploits/39161" target="_blank">Rejetto HTTP File Server (HFS) 2.3.x - Remote Command Execution (2)</a></p>

<p>This script exploits a vulnerability located at the HFS search field to inject malicious commands using the HFS syntax.
After doing some minimal changes in the script to adapt our reverse shell stager, we send the exploit to the box using the Python module named SimpleHTTPServer:</p>

<blockquote>
  <p>python -m SimpleHTTPServer 5000</p>
</blockquote>

<p>After that we set up our netcat on listening mode and execute the exploit:</p>

<p><a href="/assets/hackthebox/optimum/optimum-02-37925fd1028064472fa5bc79d4ead6e1a78779b60698ea5dda987e7c40e2f9e1.png">
  <img src="/assets/hackthebox/optimum/optimum-02-37925fd1028064472fa5bc79d4ead6e1a78779b60698ea5dda987e7c40e2f9e1.png" alt="Optimum Exploit" class="zooming" data-rjs="/assets/hackthebox/optimum/optimum-02-37925fd1028064472fa5bc79d4ead6e1a78779b60698ea5dda987e7c40e2f9e1.png" data-zooming-width="428" data-zooming-height="203" />
</a></p>

<h1 id="exploiting---using-a-metasploit-module">Exploiting - Using a Metasploit module</h1>

<p>There’s a Metasploit module for this exploit available:</p>

<p><a href="https://www.rapid7.com/db/modules/exploit/windows/http/rejetto_hfs_exec" target="_blank">Rejetto HttpFileServer Remote Command Execution</a></p>

<p><a href="/assets/hackthebox/optimum/optimum-03-26d3ffba80eb9f027d048d834fdb6307bc41d2f36cea4b3f3ed336a5d61e6927.png">
  <img src="/assets/hackthebox/optimum/optimum-03-26d3ffba80eb9f027d048d834fdb6307bc41d2f36cea4b3f3ed336a5d61e6927.png" alt="Optimum Exploit" class="zooming" data-rjs="/assets/hackthebox/optimum/optimum-03-26d3ffba80eb9f027d048d834fdb6307bc41d2f36cea4b3f3ed336a5d61e6927.png" data-zooming-width="711" data-zooming-height="557" />
</a></p>

<h1 id="exploiting---using-a-custom-exploit">Exploiting - Using a custom exploit</h1>

<p>For knowledge purposes I made a custom exploit that exploits this vulnerability and spawn an interactive shell to us, it’s available on my GitHub :)</p>

<p><a href="https://github.com/nullarmor/hackthebox-exploits/tree/master/optimum" target="_blank">Optimum Exploit</a></p>

<p><a href="/assets/hackthebox/optimum/optimum-04-23f6db375b8fd8ba78ca1e5482cb2ea6eaf833970d6a75a627fe5452e0a77c4b.png">
  <img src="/assets/hackthebox/optimum/optimum-04-23f6db375b8fd8ba78ca1e5482cb2ea6eaf833970d6a75a627fe5452e0a77c4b.png" alt="Optimum Exploit" class="zooming" data-rjs="/assets/hackthebox/optimum/optimum-04-23f6db375b8fd8ba78ca1e5482cb2ea6eaf833970d6a75a627fe5452e0a77c4b.png" data-zooming-width="712" data-zooming-height="202" />
</a></p>

<h1 id="post-exploitation---privilege-escalation-through-metasploit">Post Exploitation - Privilege escalation through Metasploit</h1>

<p>After the initial enumeration using the Metasploit post exploit module named <code class="highlighter-rouge">local_exploit_suggester</code>, we found a possible exploit named <code class="highlighter-rouge">MS16-098</code>:</p>

<p><a href="https://blog.rapid7.com/2015/08/11/metasploit-local-exploit-suggester-do-less-get-more/" target="_blank">Metasploit Local Exploit Suggester: Do Less, Get More!</a></p>

<p><a href="https://www.exploit-db.com/exploits/41020" target="_blank">Microsoft Windows 8.1 (x64) - ‘RGNOBJ’ Integer Overflow (MS16-098)</a></p>

<p>All we need to do is download the executable exploit from: <a href="https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/41020.exe">https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/41020.exe</a></p>

<p>Upload the exploit through the meterpreter:</p>

<blockquote>
  <p>upload 41020.exe</p>
</blockquote>

<p>And then execute the exploit to escalate our privileges to <em>NT Authority\SYSTEM</em>!</p>

<p><a href="/assets/hackthebox/optimum/optimum-05-c6911f48241bf3cb2543d1bb6cd2195b08167d59bf96abc7e8f3ee230f83a5a5.png">
  <img src="/assets/hackthebox/optimum/optimum-05-c6911f48241bf3cb2543d1bb6cd2195b08167d59bf96abc7e8f3ee230f83a5a5.png" alt="Optimum Post Exploitation" class="zooming" data-rjs="/assets/hackthebox/optimum/optimum-05-c6911f48241bf3cb2543d1bb6cd2195b08167d59bf96abc7e8f3ee230f83a5a5.png" data-zooming-width="506" data-zooming-height="322" />
</a></p>

<p><code class="highlighter-rouge">Windows Exploit Suggester</code> is another great tool to enumerate Windows OS :)</p>

<p><a href="https://github.com/AonCyberLabs/Windows-Exploit-Suggester" target="_blank">Windows Exploit Suggester</a></p>

<h1 id="post-exploitation---using-a-custom-exploit">Post Exploitation - Using a custom exploit</h1>

<p>I made a v2 exploit, this version escalates the privileges through the MS16-098 automatically.
After the initial exploit my script send a Powershell Drive-By to download and execute the compiled exploit executable that contains another Powershell command to establish a reverse shell as privileged user.</p>

<p><a href="https://github.com/nullarmor/hackthebox-exploits/tree/master/optimum" target="_blank">Optimum Exploit v2</a></p>

<p><a href="/assets/hackthebox/optimum/optimum-06-d48b69d57f45f30bf300881d34941c8a97421e692ec788a8315550f353a1bac2.png">
  <img src="/assets/hackthebox/optimum/optimum-06-d48b69d57f45f30bf300881d34941c8a97421e692ec788a8315550f353a1bac2.png" alt="Optimum Post Exploitation" class="zooming" data-rjs="/assets/hackthebox/optimum/optimum-06-d48b69d57f45f30bf300881d34941c8a97421e692ec788a8315550f353a1bac2.png" data-zooming-width="667" data-zooming-height="332" />
</a></p>

          </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=Optimum+-+Hack+The+Box%20-%20https://nullarmor.github.io/posts/optimum%20by%20@nullarmor" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https://nullarmor.github.io/posts/optimum" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
          </div>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script src="https://nullarmor.disqus.com/embed.js" async defer></script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
          
        </article>
        <footer class="footer scrollappear">
  <p>
    This site uses Chalk theme made by Nielsen Ramon.
  </p>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-159304176-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-159304176-1');
  </script>


<script type="text/javascript" src="/assets/vendor-2c224c53eb697c739f9490c38819a72184f09472739fd9e492272ef174090428.js"></script>


  <script type="text/javascript" src="/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js"></script>



  <script type="text/javascript" src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js"></script>


<script type="text/javascript" src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js"></script>


  <script type="text/javascript" src="/assets/themetoggle-df0d3d73164dc26dffbd630182ae4d0dfa7bee6b694a2b5d565d73595b582bbf.js"></script>

</body>
</html>
